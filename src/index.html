<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheetahNote - 极速笔记</title>
    <!-- [修复] 正确引入 vis-network -->
	<script type="text/javascript" src="vendor/vis/vis-network.min.js"></script>
    <link href="vendor/vis/vis-network.min.css" rel="stylesheet" type="text/css" />
    <link href="vendor/vis/vis-network.min.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/utils.css">
	    <!-- ⭐ Milkdown 编辑器样式 -->
    <link rel="stylesheet" href="css/milkdown-theme.css">
	<!-- ⭐【新增】插件系统样式 -->
	<link rel="stylesheet" href="css/plugin-ui.css">
</head>

<body>
    <div class="container">
	    <!-- 🆕 新增：最左侧工具栏 sync-workspace-btn-->
        <div class="app-toolbar">
		     <button id="sidebar-collapse-btn" class="toolbar-collapse-btn" title="折叠/展开侧边栏">◀</button>
            <button id="open-folder-btn" class="toolbar-icon-btn" title="打开文件夹">📂</button>
            <button id="theme-toggle-btn" class="toolbar-icon-btn" title="切换主题">🌙</button>
            <button id="graph-view-btn" class="toolbar-icon-btn" title="关系图谱">🌐</button>
        </div>
        <!-- ✏️ 修改：原侧边栏 -->
        <aside class="sidebar">
            <div class="sidebar-header">
      
                <div class="sidebar-header-actions">
                    <button id="new-note-root-btn" class="icon-btn" title="新建笔记 (Ctrl+N)">📄</button>
                    <button id="new-folder-root-btn" class="icon-btn" title="新建文件夹 (Ctrl+Shift+N)">📁</button>
                    <button id="toggle-tags-btn" class="icon-btn" title="所有标签">🏷️</button>
                    <button id="outline-btn" class="icon-btn" title="大纲">☰</button>
                </div>
            </div>
            
			<!-- ✏️ 搜索框始终显示，移除 style="display: none;" -->
			<div class="search-box" id="search-box">
				<div class="search-input-wrapper">
					<span class="search-icon">🔍</span>
					<input type="text" id="search-input" placeholder="搜索全部笔记" />
					<button id="clear-search-btn" class="clear-search-btn" style="display: none;">✕</button>
				</div>
			</div>

            <div id="tags-popover" class="tags-popover" style="display: none;">
                <div class="sidebar-section-header">
                    <h3>所有标签</h3>
                    <button id="clear-filter-btn" class="clear-filter-btn" style="display: none;">显示全部</button>
                </div>
                <ul id="tag-sidebar-list" class="tag-sidebar-list"></ul>
            </div>
            
            <div id="file-view-container" class="file-list-container">
                <ul id="file-list" class="file-list"></ul>
            </div>
            <ul id="search-results-list" class="file-list search-results" style="display: none;"></ul>
            
            <div class="sidebar-section">
                <div class="sidebar-section-header">
                    <h3>提及此笔记</h3>
                </div>
                <ul id="backlinks-list" class="backlinks-list"></ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-section-header">
                    <h3>我的标签</h3>
                    <button id="manage-tags-btn" class="icon-btn" title="管理标签">🏷️</button>
                </div>
                <ul id="current-file-tags-list" class="current-file-tags-list">
                    <li class="no-tags-info">未打开文件</li>
                </ul>
            </div>
        </aside>

        <div id="context-menu" class="context-menu">
            <ul>
			     <li id="rename-item-btn" class="context-menu-btn">重命名</li>
                <li id="pin-note-btn">📌 置顶笔记</li>
                <li id="unpin-note-btn" style="display: none;">📌 取消置顶</li>
                <li id="new-note-btn">📄 新建笔记</li>
                <li id="new-folder-btn">📁 新建文件夹</li>
                <li id="delete-file-btn">🗑️ 删除</li>
            </ul>
        </div>

        <main class="main-content">
            <div class="main-header">
                <div class="static-tabs">
                    <button id="tab-home" class="tab-btn active">首页</button>
                </div>
                <div id="dynamic-tab-container" class="dynamic-tabs"></div>
                <button id="add-new-note-tab-btn" class="icon-btn add-tab-btn">+</button>
                <div class="header-spacer"></div>
                <div id="main-header-actions" class="main-header-actions" style="display: none;">
                    <button id="view-toggle-btn" class="mode-btn">👁️ 预览</button> 
                    <button id="save-btn" class="save-btn">💾 保存</button>
                </div>
            </div>
        
            <div id="content-area">
                <div id="homepage" class="tab-content active">
                    <div class="homepage-section">
                        <h3>📌 置顶笔记</h3>
                        <div id="pinned-notes-grid" class="pinned-notes-grid"></div>
                    </div>
                    <hr class="section-divider">
                    <div class="homepage-section">
                        <h3>最近的笔记</h3>
                        <div id="history-list" class="history-list"></div>
                    </div>
                </div>
                
                <div id="editor-wrapper" class="tab-content">
				     <div id="editor-container" class="editor-container">
						  <!-- 移除旧的 textarea 和 预览区 -->
						<!-- 替换为 Milkdown 容器 -->
						<div id="milkdown-editor" class="milkdown-container"></div>
					</div>
                                      
                </div>
            </div>
        </main>
    </div>

    <div id="graph-overlay" class="graph-overlay" style="display: none;">
       <div id="graph-container"></div>
       <button id="close-graph-btn" class="close-graph-btn">×</button>
    </div>

    <div id="custom-confirm-dialog" class="custom-dialog-overlay" style="display: none;">
        <div class="custom-dialog">
            <div class="dialog-header">
                <span id="dialog-icon" class="dialog-icon">⚠️</span>
                <h3 id="dialog-title">确认</h3>
            </div>
            <div class="dialog-content">
                <p id="dialog-message">确定要执行此操作吗？</p>
            </div>
            <div class="dialog-actions">
                <button id="dialog-cancel-btn" class="btn-secondary">取消</button>
                <button id="dialog-confirm-btn" class="btn-danger">确认</button>
            </div>
        </div>
    </div>
    
    <div id="tag-modal-overlay" class="custom-dialog-overlay" style="display: none;">
        <div class="tag-modal">
            <div class="tag-modal-header">
                <h3>设置标签</h3>
                <button id="tag-modal-close-btn" class="close-btn">×</button>
            </div>
            <div class="tag-modal-content">
                <div class="tag-search-wrapper">
                    <input type="text" id="tag-modal-search-input" placeholder="搜索或创建新标签...">
                </div>
                <div class="tag-section">
                    <h4>我的标签</h4>
                    <div id="tag-modal-current-tags" class="tag-group"></div>
                </div>
                <div class="tag-section">
                    <h4>所有标签</h4>
                    <div id="tag-modal-all-tags" class="tag-group"></div>
                </div>
            </div>
            <div class="tag-modal-footer">
                <button id="tag-modal-cancel-btn" class="btn-secondary">取消</button>
                <button id="tag-modal-done-btn" class="btn-primary">完成</button>
            </div>
        </div>
    </div>
	
	<!-- ⭐ 统一入口 -->
	<script type="module" src="js/main.js"></script>
	<!-- Milkdown 编辑器 -->
	<script type="module" src="js/milkdown-editor.js"></script>
	<!-- 插件系统 -->
	<script type="module" src="js/plugin-context.js"></script>
	<script type="module" src="js/plugin-manager.js"></script>

</body>
</html>